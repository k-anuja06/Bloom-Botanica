import{c as Q,r as m,b as P,u as $,j as e,D as b,V as x,A as N,S as E,q as A}from"./index-DOuJ7_mk.js";import{A as q}from"./AddAddress-N2-s6T2h.js";import"./index-Da9-5BbU.js";var T="https://js.stripe.com/v3",F=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,L="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",M=function(){for(var r=document.querySelectorAll('script[src^="'.concat(T,'"]')),n=0;n<r.length;n++){var s=r[n];if(F.test(s.src))return s}return null},C=function(r){var n="",s=document.createElement("script");s.src="".concat(T).concat(n);var t=document.head||document.body;if(!t)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return t.appendChild(s),s},V=function(r,n){!r||!r._registerWrapper||r._registerWrapper({name:"stripe-js",version:"4.6.0",startTime:n})},p=null,v=null,g=null,W=function(r){return function(){r(new Error("Failed to load Stripe.js"))}},B=function(r,n){return function(){window.Stripe?r(window.Stripe):n(new Error("Stripe.js not available"))}},H=function(r){return p!==null?p:(p=new Promise(function(n,s){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe&&r&&console.warn(L),window.Stripe){n(window.Stripe);return}try{var t=M();if(t&&r)console.warn(L);else if(!t)t=C(r);else if(t&&g!==null&&v!==null){var d;t.removeEventListener("load",g),t.removeEventListener("error",v),(d=t.parentNode)===null||d===void 0||d.removeChild(t),t=C(r)}g=B(n,s),v=W(s),t.addEventListener("load",g),t.addEventListener("error",v)}catch(f){s(f);return}}),p.catch(function(n){return p=null,Promise.reject(n)}))},U=function(r,n,s){if(r===null)return null;var t=r.apply(void 0,n);return V(t,s),t},h,R=!1,_=function(){return h||(h=H(null).catch(function(r){return h=null,Promise.reject(r)}),h)};Promise.resolve().then(function(){return _()}).catch(function(i){R||console.warn(i)});var X=function(){for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];R=!0;var t=Date.now();return _().then(function(d){return U(d,n,t)})};const J=()=>{const{notDiscountTotalPrice:i,totalPrice:r,totalQty:n,fetchCartItem:s,fetchOrder:t}=Q(),[d,f]=m.useState(!1),[o,I]=m.useState(null),[u,w]=m.useState(!0),[c,D]=m.useState([]),y=P(a=>a.cartItem.cart),k=$(),S=P(a=>a.addresses.addressList);m.useEffect(()=>{w(!0);const a=setTimeout(()=>{D(S),w(!1)},800);return()=>clearTimeout(a)},[S]);const G=async()=>{if(o===null||!c[o])return x.error("Please select a valid address");try{const a=await N({...E.CashOnDeliveryOrder,data:{list_items:y,addressId:c[o]._id,subTotalAmt:r,totalAmt:r}});a.data.success&&(x.success(a.data.message),s==null||s(),t==null||t(),k("/success",{state:{text:"Order"}}))}catch(a){A(a)}},O=async()=>{if(o===null||!c[o])return x.error("Please select a valid address");const l=await X("pk_test_51R3tPX04oN3QiEmPivaujiggZCHgxEEIR16P0lncak8m9OytTQnEBRNBMHbM56oTPC19iLkQj5f0lgu5iuGfNrsd00HzPf3APG");x.promise(N({...E.payment_url,data:{list_items:y,addressId:c[o]._id,subTotalAmt:r,totalAmt:r}}),{loading:"Redirecting to payment...",success:async j=>(await l.redirectToCheckout({sessionId:j.data.id}),s==null||s(),t==null||t(),"Redirected to Stripe"),error:j=>A(j)})};return e.jsxs("section",{className:"bg-green-50 min-h-screen overflow-y-auto overflow-x-hidden",children:[e.jsxs("div",{className:"container mx-auto p-4 flex flex-col lg:flex-row gap-5",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Choose your address"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md space-y-4 min-h-[200px]",children:[u?e.jsx(e.Fragment,{children:[...Array(2)].map((a,l)=>e.jsx("div",{className:"h-20 bg-gray-100 animate-pulse rounded"},l))}):c.length===0?e.jsx("p",{className:"text-gray-500 text-center",children:"No address found. Please add one."}):c.map((a,l)=>a.status&&e.jsx("label",{htmlFor:`address${l}`,className:"block cursor-pointer",children:e.jsxs("div",{className:`border rounded p-3 flex gap-3 hover:bg-green-50 ${o===l?"border-green-600":""}`,children:[e.jsx("input",{type:"radio",id:`address${l}`,name:"address",value:l,checked:o===l,onChange:()=>I(l)}),e.jsxs("div",{children:[e.jsx("p",{children:a.address_line}),e.jsxs("p",{children:[a.city,", ",a.state]}),e.jsxs("p",{children:[a.country," - ",a.pincode]}),e.jsxs("p",{children:["Mobile: ",a.mobile]})]})]})},a._id)),e.jsx("div",{onClick:()=>f(!0),className:"h-16 bg-green-50 border-2 border-dashed flex justify-center items-center cursor-pointer rounded text-green-700 font-medium",children:"+ Add new address"})]})]}),e.jsxs("div",{className:"w-full max-w-md bg-white py-4 px-5 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Summary"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Items total"}),e.jsxs("span",{children:[e.jsx("span",{className:"line-through text-gray-400 mr-2",children:b(i)}),e.jsx("span",{children:b(r)})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Quantity"}),e.jsxs("span",{children:[n," item",n>1?"s":""]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery Charge"}),e.jsx("span",{children:"Free"})]}),e.jsxs("div",{className:"flex justify-between font-semibold border-t pt-3",children:[e.jsx("span",{children:"Grand Total"}),e.jsx("span",{children:b(r)})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("button",{onClick:O,disabled:o===null||u,className:`w-full py-2 px-4 font-semibold rounded ${o===null||u?"bg-green-200 text-white cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,children:"Pay with Card / UPI"}),e.jsx("button",{onClick:G,disabled:o===null||u,className:`w-full py-2 px-4 font-semibold rounded border-2 ${o===null||u?"border-green-200 text-green-300 cursor-not-allowed":"border-green-600 text-green-600 hover:bg-green-600 hover:text-white"}`,children:"Cash on Delivery"})]})]})]}),d&&e.jsx(q,{close:()=>f(!1)})]})};export{J as default};
